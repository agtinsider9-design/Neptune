<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEPTUNE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Outfit', sans-serif;
            background: radial-gradient(circle at top left, #1a1c2e, #0f1016);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        /* Glassmorphism Card */
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        .input-focus:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f1016; 
        }
        ::-webkit-scrollbar-thumb {
            background: #2d3047; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #434766; 
        }

        /* Animations */
        @keyframes fade-in-up {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in-up {
            animation: fade-in-up 0.6s ease-out forwards;
        }

        .aspect-btn.active {
            background-color: #4f46e5;
            border-color: #4f46e5;
            color: white;
        }

        /* Tab Switcher Styling */
        .tab-btn {
            transition: all 0.3s ease;
        }
        .tab-btn.active {
            background-color: #4f46e5;
            color: white;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

        /* Chat Specifics */
        .chat-bubble-user {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            border-radius: 18px 18px 0 18px;
        }
        .chat-bubble-bot {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 18px 18px 18px 0;
        }
        .typing-dot {
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .file-upload-zone {
            border: 2px dashed rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .file-upload-zone:hover, .file-upload-zone.drag-active {
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.05);
        }
        
        .placeholder-pattern {
            background-color: #1e2130;
            background-image: radial-gradient(#2d3047 1px, transparent 1px);
            background-size: 20px 20px;
        }
    </style>
</head>
<body class="flex flex-col items-center p-4 min-h-screen">

    <!-- Header & Navigation -->
    <header class="w-full max-w-6xl flex flex-col sm:flex-row justify-between items-center mb-6 gap-4 animate-fade-in-up">
        <div class="flex items-center gap-3">
            <div class="bg-indigo-500/20 p-2.5 rounded-xl text-indigo-400 border border-indigo-500/20">
                <i class="fa-solid fa-layer-group text-xl"></i>
            </div>
            <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400">
                NEPTUNE
            </h1>
        </div>

        <!-- Tab Switcher -->
        <div class="flex bg-[#0f1016]/60 p-1 rounded-xl border border-gray-700/50 backdrop-blur-md z-50">
            <button onclick="window.switchTab('image')" id="tab-image" class="tab-btn active px-6 py-2 rounded-lg text-sm font-medium text-gray-400 hover:text-white flex items-center gap-2">
                <i class="fa-solid fa-wand-magic-sparkles"></i> Image AI
            </button>
            <button onclick="window.switchTab('chat')" id="tab-chat" class="tab-btn px-6 py-2 rounded-lg text-sm font-medium text-gray-400 hover:text-white flex items-center gap-2">
                <i class="fa-solid fa-robot"></i> BatGPT
            </button>
        </div>
    </header>

    <!-- VIEW 1: IMAGE GENERATOR -->
    <div id="image-view" class="w-full max-w-6xl grid grid-cols-1 lg:grid-cols-2 gap-8 animate-fade-in-up transition-opacity duration-300">
        
        <!-- Controls -->
        <div class="glass-card rounded-3xl p-6 sm:p-8 flex flex-col h-full">
            <div class="mb-6">
                <h2 class="text-xl font-semibold text-gray-200">Image Generator</h2>
                <p class="text-gray-400 text-xs mt-1">Create stunning visuals with prompt engineering</p>
            </div>

            <form id="generatorForm" class="space-y-5 flex-grow flex flex-col">
                
                <!-- Prompt Section with Surprise Me -->
                <div class="space-y-2">
                    <div class="flex justify-between items-center ml-1">
                        <label class="text-xs font-medium text-gray-300 uppercase tracking-wider">Prompt</label>
                        <button type="button" id="surpriseBtn" class="text-xs text-indigo-400 hover:text-indigo-300 flex items-center gap-1 transition-colors bg-indigo-500/10 px-2 py-1 rounded-md border border-indigo-500/20">
                            <i class="fa-solid fa-dice"></i> Surprise Me
                        </button>
                    </div>
                    <textarea id="promptInput" rows="3" class="w-full bg-[#0f1016]/50 border border-gray-700/50 rounded-xl p-4 text-gray-100 placeholder-gray-600 focus:outline-none input-focus transition-all resize-none text-sm" placeholder="A futuristic city floating in the clouds, cyberpunk style..." required></textarea>
                </div>

                <div class="space-y-2">
                     <label class="text-xs font-medium text-gray-300 uppercase tracking-wider ml-1 flex justify-between">
                        <span>Reference Image</span>
                        <span id="fileName" class="text-indigo-400 text-xs truncate max-w-[150px]"></span>
                     </label>
                     <div class="relative group">
                        <input type="file" id="fileInput" class="hidden" accept="image/*">
                        <label for="fileInput" id="dropZone" class="file-upload-zone w-full rounded-xl p-3 cursor-pointer flex items-center justify-center gap-3 text-gray-400 hover:text-white group-hover:border-gray-500">
                            <i class="fa-solid fa-paperclip"></i>
                            <span class="text-xs">Attach Image (Optional)</span>
                        </label>
                        <div id="uploadPreview" class="hidden absolute top-1 right-1 bottom-1 w-16 bg-cover bg-center rounded-lg border border-gray-600"></div>
                     </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                    <div class="space-y-2">
                        <label class="text-xs font-medium text-gray-300 uppercase tracking-wider ml-1">Ratio</label>
                        <div class="grid grid-cols-3 gap-2">
                            <button type="button" data-ratio="square" class="aspect-btn active border border-gray-700/50 bg-[#0f1016]/30 rounded-lg p-2.5 text-xs font-medium text-gray-400 hover:bg-white/5 transition-all flex flex-col items-center gap-1.5">
                                <div class="w-3.5 h-3.5 border-2 border-current rounded-sm"></div> Square
                            </button>
                            <button type="button" data-ratio="portrait" class="aspect-btn border border-gray-700/50 bg-[#0f1016]/30 rounded-lg p-2.5 text-xs font-medium text-gray-400 hover:bg-white/5 transition-all flex flex-col items-center gap-1.5">
                                <div class="w-2.5 h-3.5 border-2 border-current rounded-sm"></div> Portrait
                            </button>
                            <button type="button" data-ratio="landscape" class="aspect-btn border border-gray-700/50 bg-[#0f1016]/30 rounded-lg p-2.5 text-xs font-medium text-gray-400 hover:bg-white/5 transition-all flex flex-col items-center gap-1.5">
                                <div class="w-4 h-2.5 border-2 border-current rounded-sm"></div> Land...
                            </button>
                        </div>
                        <input type="hidden" id="aspectRatio" value="square">
                    </div>

                    <div class="space-y-2">
                        <label class="text-xs font-medium text-gray-300 uppercase tracking-wider ml-1">Style</label>
                        <div class="relative">
                            <select id="styleSelect" class="w-full appearance-none bg-[#0f1016]/30 border border-gray-700/50 rounded-xl p-3 pl-4 pr-10 text-sm text-gray-300 focus:outline-none input-focus transition-all cursor-pointer">
                                <option value="">None (Raw)</option>
                                <option value="cinematic lighting, 8k, photorealistic">Cinematic</option>
                                <option value="anime style, studio ghibli">Anime</option>
                                <option value="cyberpunk, neon lights">Cyberpunk</option>
                                <option value="3d render, unreal engine 5">3D Render</option>
                                <option value="oil painting, vincent van gogh">Oil Painting</option>
                            </select>
                            <div class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none">
                                <i class="fa-solid fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" id="generateBtn" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl p-3.5 font-semibold transition-all shadow-lg shadow-indigo-900/20 mt-auto flex justify-center items-center gap-2">
                    <i class="fa-solid fa-wand-magic"></i> <span id="btnText">Generate</span>
                </button>
            </form>
        </div>

        <!-- Preview -->
        <div class="glass-card rounded-3xl p-4 sm:p-8 flex flex-col h-full min-h-[400px] relative overflow-hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-medium text-gray-200">Result</h2>
                <div id="statusBadge" class="hidden px-3 py-1 rounded-full bg-yellow-500/10 text-yellow-400 text-xs font-medium border border-yellow-500/20 flex items-center gap-2">
                    <span class="w-1.5 h-1.5 bg-yellow-400 rounded-full animate-pulse"></span> Processing
                </div>
            </div>

            <div class="flex-grow rounded-2xl overflow-hidden placeholder-pattern border border-gray-700/30 relative flex items-center justify-center">
                <div id="placeholderState" class="text-center p-6">
                    <div class="w-16 h-16 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-600">
                        <i class="fa-regular fa-image text-2xl"></i>
                    </div>
                    <p class="text-gray-500 text-xs">Generated artwork appears here</p>
                </div>

                <div id="loadingState" class="hidden absolute inset-0 bg-black/60 backdrop-blur-sm flex flex-col items-center justify-center z-20">
                    <div class="w-12 h-12 border-4 border-indigo-500/30 border-t-indigo-500 rounded-full animate-spin mb-3"></div>
                    <p class="text-indigo-300 text-sm font-medium animate-pulse">Designing...</p>
                </div>

                <!-- FIX: Removed crossOrigin attribute to ensure display works -->
                <img id="resultImage" src="" class="hidden w-full h-full object-contain z-10">

                <div id="actionOverlay" class="hidden absolute bottom-4 flex gap-3 z-20">
                    <button id="downloadBtn" class="bg-white text-black px-4 py-2 rounded-full text-xs font-bold hover:bg-gray-200 shadow-lg flex items-center gap-2">
                        <i class="fa-solid fa-download"></i> Save
                    </button>
                    <button onclick="window.open(document.getElementById('resultImage').src, '_blank')" class="bg-black/50 backdrop-blur text-white px-4 py-2 rounded-full text-xs font-bold border border-white/20 hover:bg-black/70 shadow-lg">
                        Expand
                    </button>
                </div>
            </div>
            
            <div id="errorMessage" class="hidden mt-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-200 text-xs flex items-center gap-2">
                <i class="fa-solid fa-circle-exclamation"></i> <span id="errorText">Error</span>
            </div>
        </div>
    </div>

    <!-- VIEW 2: CHATBOT -->
    <div id="chat-view" class="hidden w-full max-w-4xl h-[600px] glass-card rounded-3xl flex flex-col overflow-hidden animate-fade-in-up">
        
        <!-- Chat Header -->
        <div class="bg-black/20 p-4 border-b border-gray-700/30 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center text-white shadow-lg shadow-indigo-500/20">
                    <i class="fa-solid fa-robot"></i>
                </div>
                <div>
                    <h3 class="font-bold text-gray-100">BatGPT</h3>
                    <p class="text-xs text-indigo-300 flex items-center gap-1">
                        <span class="w-1.5 h-1.5 bg-green-500 rounded-full"></span> Online
                    </p>
                </div>
            </div>
            <button onclick="clearChat()" class="text-gray-500 hover:text-white text-xs uppercase tracking-wide px-3 py-1 rounded hover:bg-white/5 transition-colors">
                Clear Chat
            </button>
        </div>

        <!-- Messages Area -->
        <div id="chatMessages" class="flex-grow overflow-y-auto p-4 sm:p-6 space-y-6 scroll-smooth">
            <!-- Intro Message -->
            <div class="flex items-start gap-3">
                <div class="w-8 h-8 rounded-full bg-indigo-600/20 flex items-center justify-center text-indigo-400 text-xs shrink-0 border border-indigo-500/20">
                    <i class="fa-solid fa-robot"></i>
                </div>
                <div class="chat-bubble-bot p-4 text-sm text-gray-300 max-w-[85%] leading-relaxed">
                    Hello! I am BatGPT. Ask me anything or tell me about your mission! ðŸ¦‡
                </div>
            </div>
        </div>

        <!-- Chat Input -->
        <div class="p-4 bg-black/20 border-t border-gray-700/30">
            <form id="chatForm" class="relative flex items-center gap-2">
                <input type="text" id="chatInput" 
                    class="w-full bg-[#0f1016] border border-gray-700/50 rounded-xl py-3.5 pl-4 pr-12 text-sm text-gray-200 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/50 transition-all placeholder-gray-600"
                    placeholder="Type your message here..." autocomplete="off">
                
                <button type="submit" id="sendBtn" class="absolute right-2 p-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg transition-colors shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fa-solid fa-paper-plane text-xs"></i>
                </button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="w-full max-w-6xl mt-auto pt-8 pb-2 px-4 text-gray-500 text-xs flex justify-start animate-fade-in-up">
        <p>All rights reserved. Powered by Sudais Saeed.</p>
    </footer>

    <script>
        // --- TAB SWITCHING LOGIC (Globally Scoped) ---
        window.switchTab = function(tab) {
            const imageView = document.getElementById('image-view');
            const chatView = document.getElementById('chat-view');
            const tabImage = document.getElementById('tab-image');
            const tabChat = document.getElementById('tab-chat');

            if (tab === 'image') {
                imageView.classList.remove('hidden');
                imageView.classList.add('grid'); 
                chatView.classList.add('hidden');
                chatView.classList.remove('flex'); 
                tabImage.classList.add('active');
                tabChat.classList.remove('active');
            } else {
                imageView.classList.add('hidden');
                imageView.classList.remove('grid');
                chatView.classList.remove('hidden');
                chatView.classList.add('flex'); 
                tabImage.classList.remove('active');
                tabChat.classList.add('active');
            }
        };

        // --- IMAGE GENERATOR LOGIC ---
        const generatorForm = document.getElementById('generatorForm');
        const promptInput = document.getElementById('promptInput');
        const styleSelect = document.getElementById('styleSelect');
        const aspectRatioInput = document.getElementById('aspectRatio');
        const aspectBtns = document.querySelectorAll('.aspect-btn');
        const generateBtn = document.getElementById('generateBtn');
        const resultImage = document.getElementById('resultImage');
        const placeholderState = document.getElementById('placeholderState');
        const loadingState = document.getElementById('loadingState');
        const actionOverlay = document.getElementById('actionOverlay');
        const statusBadge = document.getElementById('statusBadge');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const downloadBtn = document.getElementById('downloadBtn');
        const fileInput = document.getElementById('fileInput');
        const fileNameDisplay = document.getElementById('fileName');
        const uploadPreview = document.getElementById('uploadPreview');
        const surpriseBtn = document.getElementById('surpriseBtn');

        // Surprise Me Logic
        const surprisePrompts = [
            "A futuristic cyberpunk city with neon lights and flying cars, 8k resolution, cinematic lighting",
            "An astronaut riding a horse on Mars, digital art, highly detailed",
            "A cute robot gardening in a post-apocalyptic world, studio ghibli style",
            "A magical forest with glowing mushrooms and fairy dust, fantasy art",
            "Portrait of a warrior princess in golden armor, intricate details, photorealistic",
            "A giant whale swimming through the clouds, dreamlike atmosphere",
            "A cozy cabin in the snowy mountains at night, warm lighting",
            "A steampunk owl with mechanical wings, concept art",
            "An underwater city made of crystal, bioluminescent lighting",
            "A cat wearing a space suit floating in zero gravity, cute and detailed"
        ];

        surpriseBtn.addEventListener('click', () => {
            const randomPrompt = surprisePrompts[Math.floor(Math.random() * surprisePrompts.length)];
            promptInput.value = randomPrompt;
            // Optional: Add a little flash effect to input
            promptInput.classList.add('bg-indigo-900/20');
            setTimeout(() => promptInput.classList.remove('bg-indigo-900/20'), 300);
        });

        aspectBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                aspectBtns.forEach(b => b.classList.remove('active', 'bg-[#4f46e5]', 'text-white', 'border-[#4f46e5]'));
                aspectBtns.forEach(b => b.classList.add('bg-[#0f1016]/30', 'text-gray-400', 'border-gray-700/50'));
                btn.classList.remove('bg-[#0f1016]/30', 'text-gray-400', 'border-gray-700/50');
                btn.classList.add('active', 'bg-[#4f46e5]', 'text-white', 'border-[#4f46e5]');
                aspectRatioInput.value = btn.dataset.ratio;
            });
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                fileNameDisplay.textContent = file.name;
                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadPreview.style.backgroundImage = `url(${e.target.result})`;
                    uploadPreview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            } else {
                fileNameDisplay.textContent = '';
                uploadPreview.classList.add('hidden');
            }
        });

        // Robust Download Logic
        downloadBtn.addEventListener('click', async () => {
            const url = resultImage.src;
            if (!url) return;
            const originalText = downloadBtn.innerHTML;
            downloadBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Saving...';
            
            try {
                // Attempt direct fetch (Browser might block if CORS header is missing)
                const response = await fetch(url, { mode: 'cors' });
                if (!response.ok) throw new Error("Network error");
                const blob = await response.blob();
                const blobUrl = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = blobUrl;
                link.download = `fam-ofc-ai-${Date.now()}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                setTimeout(() => window.URL.revokeObjectURL(blobUrl), 100);
            } catch (err) {
                console.warn("Download fallback used due to CORS/Browser restrictions", err);
                
                // Fallback: Open in new tab and show instruction
                window.open(url, '_blank');
                
                // Create a temporary toast message
                const toast = document.createElement('div');
                toast.className = 'fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-xl z-50 flex items-center gap-3 border border-gray-700 animate-fade-in-up';
                toast.innerHTML = `
                    <i class="fa-solid fa-info-circle text-indigo-400"></i>
                    <span class="text-sm font-medium">Image opened in new tab. Long press to save!</span>
                `;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 5000);

            } finally {
                downloadBtn.innerHTML = originalText;
            }
        });

        generatorForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const rawPrompt = promptInput.value.trim();
            const style = styleSelect.value;
            const aspectRatio = aspectRatioInput.value;
            const file = fileInput.files[0];

            if (!rawPrompt) return;
            const finalPrompt = style ? `${rawPrompt}, ${style}` : rawPrompt;

            generateBtn.disabled = true;
            generateBtn.classList.add('opacity-70');
            placeholderState.classList.add('hidden');
            resultImage.classList.add('hidden');
            actionOverlay.classList.add('hidden');
            errorMessage.classList.add('hidden');
            loadingState.classList.remove('hidden');
            statusBadge.classList.remove('hidden');

            try {
                const baseUrl = "https://famofc.site/api/generate.php";
                let response;
                if (file) {
                    const formData = new FormData();
                    formData.append('prompt', finalPrompt);
                    formData.append('aspectRatio', aspectRatio);
                    formData.append('image', file);
                    response = await fetch(baseUrl, { method: 'POST', body: formData });
                } else {
                    response = await fetch(`${baseUrl}?prompt=${encodeURIComponent(finalPrompt)}&aspectRatio=${aspectRatio}`);
                }
                
                const data = await response.json();
                if (data.success && data.images && data.images.length > 0) {
                    const imgUrl = data.images[0].image_url;
                    
                    resultImage.onload = function() {
                        loadingState.classList.add('hidden');
                        statusBadge.classList.add('hidden');
                        resultImage.classList.remove('hidden');
                        actionOverlay.classList.remove('hidden');
                        generateBtn.disabled = false;
                        generateBtn.classList.remove('opacity-70');
                    };
                    
                    resultImage.onerror = function() {
                        throw new Error("Image failed to load");
                    };

                    // NO crossOrigin attribute to ensure display works
                    resultImage.removeAttribute('crossorigin');
                    resultImage.src = imgUrl;

                } else {
                    throw new Error("API returned failure");
                }
            } catch (error) {
                console.error(error);
                loadingState.classList.add('hidden');
                statusBadge.classList.add('hidden');
                errorMessage.classList.remove('hidden');
                errorText.textContent = "Generation failed. Try again.";
                generateBtn.disabled = false;
                generateBtn.classList.remove('opacity-70');
            }
        });

        // --- CHATBOT LOGIC ---
        const chatForm = document.getElementById('chatForm');
        const chatInput = document.getElementById('chatInput');
        const chatMessages = document.getElementById('chatMessages');
        const sendBtn = document.getElementById('sendBtn');

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const message = chatInput.value.trim();
            if (!message) return;

            addMessage('user', message);
            chatInput.value = '';
            
            const loadingId = addLoadingBubble();
            scrollToBottom();

            try {
                const url = `https://batgpt.vercel.app/api/gpt?message=${encodeURIComponent(message)}`;
                const response = await fetch(url);
                let replyText = "";
                const contentType = response.headers.get("content-type");
                
                if (contentType && contentType.includes("application/json")) {
                    const data = await response.json();
                    replyText = data.content || data.reply || data.text || JSON.stringify(data);
                } else {
                    replyText = await response.text();
                }
                removeMessage(loadingId);
                addMessage('bot', replyText);

            } catch (error) {
                console.error("Chat Error:", error);
                removeMessage(loadingId);
                addMessage('bot', "I'm having trouble connecting to the Batcave servers. Please try again.");
            }
        });

        function addMessage(sender, text) {
            const div = document.createElement('div');
            div.className = `flex items-start gap-3 ${sender === 'user' ? 'flex-row-reverse' : ''} animate-fade-in-up`;
            const iconHtml = sender === 'user' 
                ? `<div class="w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-white shrink-0 shadow-lg"><i class="fa-solid fa-user text-xs"></i></div>`
                : `<div class="w-8 h-8 rounded-full bg-indigo-600/20 flex items-center justify-center text-indigo-400 text-xs shrink-0 border border-indigo-500/20"><i class="fa-solid fa-robot"></i></div>`;
            const bubbleClass = sender === 'user' ? 'chat-bubble-user text-white' : 'chat-bubble-bot text-gray-300';
            const formattedText = text.replace(/\n/g, '<br>');

            div.innerHTML = `${iconHtml}<div class="${bubbleClass} p-3.5 text-sm max-w-[85%] leading-relaxed shadow-sm">${formattedText}</div>`;
            chatMessages.appendChild(div);
            scrollToBottom();
        }

        function addLoadingBubble() {
            const id = 'loading-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = "flex items-start gap-3";
            div.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-indigo-600/20 flex items-center justify-center text-indigo-400 text-xs shrink-0 border border-indigo-500/20"><i class="fa-solid fa-robot"></i></div>
                <div class="chat-bubble-bot p-4 flex gap-1 items-center h-10">
                    <div class="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div>
                    <div class="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div>
                    <div class="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div>
                </div>
            `;
            chatMessages.appendChild(div);
            return id;
        }

        function removeMessage(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        window.clearChat = function() {
            chatMessages.innerHTML = `
            <div class="flex items-start gap-3">
                <div class="w-8 h-8 rounded-full bg-indigo-600/20 flex items-center justify-center text-indigo-400 text-xs shrink-0 border border-indigo-500/20">
                    <i class="fa-solid fa-robot"></i>
                </div>
                <div class="chat-bubble-bot p-4 text-sm text-gray-300 max-w-[85%] leading-relaxed">
                    Chat cleared. How can I help you now?
                </div>
            </div>`;
        }
    </script>
</body>
</html>





